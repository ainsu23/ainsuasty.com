<!DOCTYPE html>
<html lang="es">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="es">
    <meta name="color-scheme" content="light dark">

    

    <meta name="author" content="Andres Insuasty">
    <meta name="description" content="Aprende R con datos de Colombia!!En esta ocasi√≥n revisamos la evoluci√≥n agropecuaria de Colombia por departamentos a partir del a√±o 2006 hasta el a√±o 2018. Los datos fueron extra√≠dos de los Datos Abiertos de Colombia.
R es un software estad√≠stico OpenSource, esto quiere decir que el mundo entero est√° aportando al conocimiento y desarrollo de este mismo. Por ejemplo: esta p√°gina Web y blog fueron creados s√≥lo con c√≥digo R.">
    <meta name="keywords" content="blog,developer,personal">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Crear GIFs con R: Evaluacion agricultura Colombia"/>
<meta name="twitter:description" content="Aprende R con datos de Colombia!!En esta ocasi√≥n revisamos la evoluci√≥n agropecuaria de Colombia por departamentos a partir del a√±o 2006 hasta el a√±o 2018. Los datos fueron extra√≠dos de los Datos Abiertos de Colombia.
R es un software estad√≠stico OpenSource, esto quiere decir que el mundo entero est√° aportando al conocimiento y desarrollo de este mismo. Por ejemplo: esta p√°gina Web y blog fueron creados s√≥lo con c√≥digo R."/>

    <meta property="og:title" content="Crear GIFs con R: Evaluacion agricultura Colombia" />
<meta property="og:description" content="Aprende R con datos de Colombia!!En esta ocasi√≥n revisamos la evoluci√≥n agropecuaria de Colombia por departamentos a partir del a√±o 2006 hasta el a√±o 2018. Los datos fueron extra√≠dos de los Datos Abiertos de Colombia.
R es un software estad√≠stico OpenSource, esto quiere decir que el mundo entero est√° aportando al conocimiento y desarrollo de este mismo. Por ejemplo: esta p√°gina Web y blog fueron creados s√≥lo con c√≥digo R." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://www.ainsuasty.com/es/post/crear-gifs/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-05-09T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2021-05-09T00:00:00&#43;00:00" />



    <title>
  Crear GIFs con R: Evaluacion agricultura Colombia ¬∑ AINSUASTY
</title>

    
      <link rel="canonical" href="http://www.ainsuasty.com/es/post/crear-gifs/">
    

    <link rel="preload" href="/fonts/forkawesome-webfont.woff2?v=1.1.7" as="font" type="font/woff2" crossorigin>

    
      
      
      <link rel="stylesheet" href="/css/coder.min.c884c9ebf7b9aeed5fc748f64d6575016297c22227fb677bc4429bbed48d2d9b.css" integrity="sha256-yITJ6/e5ru1fx0j2TWV1AWKXwiIn&#43;2d7xEKbvtSNLZs=" crossorigin="anonymous" media="screen" />
    

    

    
      
        
        
        <link rel="stylesheet" href="/css/coder-dark.min.dde8a61eb31a32353b4baf3d9113f03c4ea2a8ca9bb736f59ca2d2b2cb664f0b.css" integrity="sha256-3eimHrMaMjU7S689kRPwPE6iqMqbtzb1nKLSsstmTws=" crossorigin="anonymous" media="screen" />
      
    

    

    

    <link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

    
      <script defer src="https://twemoji.maxcdn.com/v/13.0.2/twemoji.min.js"
        integrity="sha384-wyB/MspSJ/r2bT2kCj44qtsYRYlpzO2oAPhRj5myrWD63dt6qWv4x8AZe7Fl3K3b" crossorigin="anonymous"></script>
    

    <meta name="generator" content="Hugo 0.82.0" />
  </head>

  
  
    
  
  <body class="preload-transitions colorscheme-auto"
        onload=" twemoji.parse(document.body); "
  >
    
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/es">
      AINSUASTY
    </a>
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link" href="/es/post/">Blog</a>
            </li>
          
        
        
          
          
          
            
          
            
              
                <li class="navigation-item menu-separator">
                  <span>|</span>
                </li>
                
              
              <li class="navigation-item">
                <a href="http://www.ainsuasty.com/">üá¨üáß</a>
              </li>
            
          
        
      </ul>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container page">
  <article>
    <header>
      <h1 class="title">
        <a class="title-link" href="http://www.ainsuasty.com/es/post/crear-gifs/">
          Crear GIFs con R: Evaluacion agricultura Colombia
        </a>
      </h1>
    </header>

    
<script src="http://www.ainsuasty.com/es/post/crear-gifs/index.es_files/header-attrs/header-attrs.js"></script>


<div id="aprende-r-con-datos-de-colombia" class="section level1">
<h1>Aprende <em>R</em> con datos de <span style="color: yellow;">Co</span><span style="color: blue;">lom</span><span style="color: red;">bia</span>!!</h1>
<p><img src="images/plot-1.gif" width="548" /></p>
<p>En esta ocasi√≥n revisamos la evoluci√≥n agropecuaria de Colombia por departamentos a partir del a√±o 2006 hasta el a√±o 2018. Los datos fueron extra√≠dos de los <a href="https://www.datos.gov.co/"><em>Datos Abiertos</em></a> de Colombia.</p>
<hr />
<p>R es un software estad√≠stico OpenSource, esto quiere decir que el mundo entero est√° aportando al conocimiento y desarrollo de este mismo. <strong>Por ejemplo: esta p√°gina Web y blog fueron creados s√≥lo con c√≥digo R.</strong></p>
<p>Lo primero que debes saber es que hay que instalar los paquetes que vas a necesitar (<code>install.packages("nombre_paquete")</code>), lo segundo es que estos paquetes contienen funciones.</p>
<p><strong><em>Por Ejemplo:</em></strong> <code>dplyr::arrange()</code> El paquete es <em>dplyr</em> (paquete para manejo de datos en tablas) y la funci√≥n es <em>arrange</em> (funci√≥n para ordenar columnas). El paquete puede contener una o m√°s funciones, para el caso de dplyr tiene funciones que sirven para: seleccionar, borrar, filtrar, agregar, entre otras.</p>
<hr />
<div id="cargue-de-librer√≠as" class="section level2">
<h2>Cargue de Librer√≠as</h2>
<p>Las librer√≠as y funciones a usar son:</p>
<pre class="r badCode"><code>library(skimr) # skimr::skim() nos brinda el resumen estad√≠stica de una tabla
library(ggplot2) #ggplot2::ggplot(),geom_text(),geom_polygon(),annotation_custom(), datos: map_data()
library(dplyr) #dplyr::select(), group_by(),summarise(), mutate()
## Warning: package &#39;dplyr&#39; was built under R version 4.0.5
library(stringr) # stringr::str_replace_all(),
## Warning: package &#39;stringr&#39; was built under R version 4.0.5
library(ggimage) # ggimage::geom_image()
library(glue) # glue:glue()
library(gganimate) # gganimate::anim_save(),transition(), exit_shrink(), exit_shrink
library(gifski)</code></pre>
</div>
<div id="lectura-de-datos" class="section level2">
<h2>Lectura de datos</h2>
<p>Las anteriores librer√≠as son exclusivas para este blog, sin embargo, existen paquetes para leer archivos pdf, word, xls o tambi√©n para extraer y enviar informaci√≥n a bases de datos. La funci√≥n <strong>read.csv</strong> nos permite leer datos <em>csv</em> tal como lo vemos a continuaci√≥n</p>
<pre class="r badCode"><code>Evol_Agrope_Colombia&lt;-read.csv(params$Evol_Agrope_Colombia)

ColombiaMap &lt;- map_data(&quot;world&quot;, region = &quot;Colombia&quot;)

MapaColombia&lt;-read.csv(params$MapaColombia)</code></pre>
<div id="resumen-de-los-datos" class="section level3">
<h3>Resumen de los datos</h3>
<p>La funci√≥n skim (<code>skim(Evol_Agrope_Colombia)</code>) brinda un resumen muy detallado de los datos. A continuaci√≥n lo explico: 1. Data Summary: resumen de la tabla, n√∫mero de filas y columnas. 2. Tipo de datos: determina el n√∫mero de columnas con tipo car√°cter, factor, num√©rico, entre otros. 3. Genera estad√≠stica descriptiva de cada variable</p>
</div>
</div>
<div id="manejo-de-datos" class="section level2">
<h2>Manejo de datos</h2>
<p>Ya que hay una mayor claridad de los datos, empecemos a <em>‚Äújugar‚Äù</em> un poco con ellos. El paquete <code>dplyr</code> nos permite hacer an√°lisis de datos de una manera muy intuitiva.</p>
<p>El c√≥digo de abajo asigna a la tabla <strong>MapaColombia</strong> con el signo ‚Äú&lt;- o =‚Äù la misma tabla <em>MapaColombia</em> pero con modificaciones en el contenido con el siguiente operador <code>%&gt;%</code> (ctrl + shift + m)</p>
<ul>
<li>seleccionar columnas especificas (select)</li>
<li>agrupar por departamento (group_by)</li>
<li>tomar la media de longitud y latitud (para asignar el nombre dentro del mapa) (summarise)</li>
<li>los departamentos que tengan espacios entre sus palabras, juntarlas con un ‚Äú_‚Äù, ejemplo ‚ÄúValle del Cauca‚Äù por ‚ÄúValle_del_Cauca‚Äù (mutate)</li>
<li>Por √∫ltimo, reemplazar nombres (mutate)</li>
</ul>
<pre class="r badCode"><code> MapaColombia&lt;-MapaColombia %&gt;%
  select(longitud,latitud,codigo_departamento,nombre_departamento) %&gt;%
  group_by(nombre_departamento,codigo_departamento) %&gt;%
  summarise(longitud=mean(longitud,na.rm = TRUE),latitud=mean(latitud,na.rm = TRUE)) %&gt;%
  mutate(nombre_departamento=str_replace_all(nombre_departamento,&quot; &quot;,&quot;_&quot;)) %&gt;%
  mutate(nombre_departamento=ifelse(nombre_departamento==&quot;ARCHIPIELAGO_DE_SAN_ANDRES,_PROVIDENCIA_Y_SANTA_CATALINA&quot;,&quot;SAN_ANDRES_Y_PROVIDENCIA&quot;,nombre_departamento))


MapaColombia %&gt;% head(5) %&gt;% as.data.frame()</code></pre>
<pre><code>##        nombre_departamento codigo_departamento  longitud   latitud
## 1                 AMAZONAS                  91 -70.45650 -3.525291
## 2                ANTIOQUIA                   5 -75.61975  6.729493
## 3                   ARAUCA                  81 -71.45004  6.789626
## 4 SAN_ANDRES_Y_PROVIDENCIA                  88 -81.50043 13.056938
## 5                ATLANTICO                   8 -74.98382 10.692110</code></pre>
<p>La tabla <strong><em>Evol_Agrope_Colombia</em></strong> necesita las siguientes modificaciones para poder tener los datos perfectos para la construcci√≥n del mapa.:</p>
<ul>
<li>Total √°rea cosechada por departamento, cultivo y a√±o.</li>
<li>Con la anterior agrupaci√≥n, quedarse con el cultivo m√°s cosechado.</li>
<li>Adicionar coordenadas en el mapa. Se hace un left_join() (tip excel: <em>buscarv</em>) con la tabla Mapa Colombia.</li>
<li>Columna image hace referencia al nombre del png a usar en la gr√°fica.</li>
</ul>
<pre class="r badCode"><code>Evol_Agrope_Colombia&lt;-Evol_Agrope_Colombia %&gt;% group_by(DEPARTAMENTO,CULTIVO,A√ëO) %&gt;%
  summarise(Area_Cosechada=sum(√Årea.Cosechada..ha.)) %&gt;% ungroup() %&gt;%
  group_by(DEPARTAMENTO,A√ëO) %&gt;%
  filter(Area_Cosechada==max(Area_Cosechada)) %&gt;% ungroup() %&gt;%
  mutate_if(is.factor,~str_replace_all(.,&quot; &quot;,&quot;_&quot;)) %&gt;%
  left_join(MapaColombia %&gt;% rename(DEPARTAMENTO=nombre_departamento),
                       by = &quot;DEPARTAMENTO&quot;) %&gt;% filter(!is.na(Area_Cosechada)) %&gt;%
  rename(long=longitud,lat=latitud) %&gt;% select(DEPARTAMENTO,A√ëO,Area_Cosechada,CULTIVO,long,lat) %&gt;%
  ungroup() %&gt;%
  as.data.frame() %&gt;% mutate(image=glue::glue(&quot;{here::here(&#39;content&#39;,&#39;post&#39;)}/{rmarkdown::metadata$date}-{stringr::str_to_lower(rmarkdown::metadata$slug)}/images/{CULTIVO}.png&quot;))</code></pre>
<p>Para situar los nombres de los departamentos, se cre√≥ la tabla <code>_region.lab.data_</code>, la cual contiene las coordenadas promedio de los departamentos de Colombia.</p>
<pre class="r badCode"><code>region.lab.data &lt;- MapaColombia %&gt;%
  group_by(nombre_departamento) %&gt;%
  summarise(long = mean(longitud), lat = mean(latitud)) %&gt;% ungroup() %&gt;%
  filter(nombre_departamento!=&quot;BOGOTA,_D._C.&quot;)</code></pre>
</div>
<div id="construcci√≥n-de-la-grafica" class="section level2">
<h2>Construcci√≥n de la grafica</h2>
<p>El siguiente c√≥digo es una combinaci√≥n de paquetes muy poderosos para la construcci√≥n de gr√°ficos. A continuaci√≥n explico cada l√≠nea del c√≥digo</p>
<ol style="list-style-type: decimal">
<li>Tomar como: + eje x: longitud + eje y: latitud</li>
<li>Dibujar el contorno del mapa de Colombia con geom_polygon, las l√≠neas son dibujadas por las coordenadas dadas en la tabla ColombiaMap</li>
<li>Con la tabla <em>Evol_Agrope_Colombia</em>, agregar las im√°genes usando las coordenadas y la columna image</li>
<li>Con la tabla <em>Evol_Agrope_Colombia</em>, agregar los nombres de cultivos en rojo usando las coordenadas y la columna CULTIVO</li>
<li>Usando el paquete gganimate y la funci√≥n transition_time, se crea un video respecto al tiempo. Las siguientes 3 l√≠neas de c√≥digo hacen referencia a efectos del video</li>
<li>Con geom_text, se agrega el nombre del departamento.</li>
</ol>
<pre class="r badCode"><code> p&lt;-ggplot(ColombiaMap,aes(x = long, y = lat)) +
   geom_polygon(aes(group = group, fill = subregion),color=&quot;orange&quot;,fill=&quot;white&quot;) +
   geom_image(data = Evol_Agrope_Colombia,aes(x=long,y=lat,image=image),size=0.07) +
   geom_text(data = Evol_Agrope_Colombia,aes(x=long,y=lat,label=CULTIVO),
             size=3,vjust=-0.5,color=&quot;red&quot;,fontface=&quot;italic&quot;)+
   transition_time(A√ëO)+
   labs(title=&quot;A√±o: {frame_time}&quot;)+
   enter_fade() +
   exit_shrink() +
   geom_text(aes(label = nombre_departamento),
             data = region.lab.data,  size = 4, hjust = 0.5,
             color=&quot;black&quot;,family = &quot;Courier&quot;,fontface=&quot;bold&quot;)+
   scale_colour_manual(values=c(&quot;#FFFFFF&quot;, &quot;#FFFFFF&quot;))+
   theme(legend.position = &quot;none&quot;)


 animate(p, height = 1200, width = 1000,fps=30,duration=15)</code></pre>
<p><img src="http://www.ainsuasty.com/es/post/crear-gifs/index.es_files/figure-html/plot-1.gif" /><!-- --></p>
<pre class="r badCode"><code> ## Guardar gif con la siguiente linea de comando
 # anim_save(animation = p,&quot;images/evolucionAgropecuaria.gif&quot;)</code></pre>
<p><img src="images/plot-1.gif" width="548" /></p>
</div>
</div>

  </article>
</section>

  

      </div>

      
  <footer class="footer">
    <section class="container">
      
        <p>Personal Website made with ‚ù§Ô∏è from Rstudio cloud + hugo + Github + imagination and hardwork.</p>
      
      
        ¬©
        
        2021
         Andres Insuasty 
      
      
         ¬∑ 
        Desarrollado por <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>.
      
      
    </section>
  </footer>


    </main>

    
      
      <script src="/js/coder.min.235666b114443867d43eeb5799d51f6252965e5163f338285e113fa381d3d27e.js" integrity="sha256-I1ZmsRREOGfUPutXmdUfYlKWXlFj8zgoXhE/o4HT0n4="></script>
    

    

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-176122758-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    

    

    

    

    

    
  </body>

</html>
