---
title: Tips de procesos de Excel en R
author: Andres Insuasty
date: '2021-08-23'
slug: []
categories:
  - Excel
tags:
  - Excel
  - tips
---
```{css,echo = FALSE}
.blocks_style {
  font-weight: bold;
  background-color: whitesmoke;
  color: black;
  font-style: italic;
  font-family: Monospace;
}
```

```{r, echo=FALSE}
knitr::opts_chunk$set(class.source = "blocks_style")

```


## Procesos de excel realizados en R

### 1. Guardar en varias pestañas de un libro

Dividir una base de un libro de excel en varias pestañas teniendo en cuenta una columna, resulta facil con el uso de **purrr**.

-   separar archivo por columna

```{r echo=TRUE, message=FALSE, warning=FALSE}

library(dplyr)

archivo <-readxl::read_excel(
  glue::glue("{here::here()}/datos/50_Mejores_Canciones_Latinas.xlsx"))
```

-   Seleccionar columna a separar y convierte a lista

```{r echo=TRUE, message=FALSE, warning=FALSE,class.source="blocks_style"}
columna <- archivo %>% 
  select(País) %>% 
  distinct() %>% as.data.frame()

lista <- as.list(columna$País)
```

-   Crea lista vacía para almacenar bases

```{r echo=TRUE, message=FALSE, warning=FALSE}
bases = list()
```

-   Guarda cada base filtrada con el registro de la lista en una lista de dataframes, adiciona nombres a los elementos de la lista y mantiene las bases que contengan registros

```{r echo=TRUE, message=FALSE, warning=FALSE}
bases <- lista %>% purrr::map(function(x){
  archivo %>% filter(País == x)
}) %>% 
  purrr::set_names(columna[,1]) %>% 
  purrr::keep(~nrow(.)>0)
```

-   Escribe en un archivo excel la lista de bases

```{r echo=TRUE, message=FALSE, warning=FALSE}
writexl::write_xlsx(x = bases,
                    path = glue::glue("{here::here()}/datos/separado.xlsx"),
                    col_names = TRUE)
```
